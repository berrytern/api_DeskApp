<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>&lt;OMG-Tools&gt;</title>
    <link rel="shortcut icon" href="/image/icone.ico" />
    <link rel="stylesheet" href="/css/access_header.css">
    <link rel="stylesheet" href="/css/loading.css">
</head>
<body>
<header class="toolbar toolbar-header">
    <label class="title">&lt;OMG-Tools&gt;</label>
</header>
<div class="loading">
    <img src="/image/loading.gif" alt="icone"/>
</div>
<script>
function js(){
    get= new XMLHttpRequest
    get.open("GET",location.href,true)
    get.setRequestHeader("Authorization","Bearer "+token)
    get.setRequestHeader("Content-Type","text/html, application/xhtml+xml, application/xml; q=0.9, */*; q=0.8")
    get.send()
    get.onload=(e)=>{
        var res =JSON.parse(get.responseText)
        if(!res.html && !!res.js){
            let algod =document.createElement('script')
            algod.src= res.js
            document.querySelector('body').appendChild(algod)} 
        else if(!!res.html && !res.js){
            document.querySelector('html').innerHTML =JSON.parse(get.responseText).html 
        } 
        else if(!res.html && !res.js){location.href ='/login'}
        else{
            let algod =document.createElement('script')
            algod.src= res.js
            document.querySelector('body').appendChild(algod)
            document.querySelector('html').innerHTML =JSON.parse(get.responseText).html 
            }
        }
    
}
var token=localStorage.getItem('token') || null
if(!token){
    alert('user not logged')
    location.href= "/login"
}
else{
    validate= new XMLHttpRequest
    validate.open("POST",location.protocol+"//"+location.hostname+':'+ location.port+'/validate')
    validate.setRequestHeader("Content-Type","application/json")
    validate.send('{"token":"'+token+'"}')
    validate.onload=(e)=>{
        console.log(validate.responseText)
        token = JSON.parse(validate.responseText).token
    
        if(token==null){
            alert('user not logged')
            location.href="/login"}
        else{
            js()
        }
    }
}
</script>
</body>
</html>